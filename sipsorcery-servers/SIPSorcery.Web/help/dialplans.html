<html>
<head>
    <title>SIP Sorcery Help</title>
    <style>
     .sectionHeading 
     {
         color: #A0F927;
         font-weight: 600;    
     }
    </style>
 </head>
 <body style="background-color: gray; font-family: Arial">
      
      <h2 class="sectionheading">
        SIP Sorcery Help - Dial Plans
     </h2>
        <a href="../help.html">Back to Contents</a><br /><br />
        For additional help or questions a community forum is available <a href="http://www.mysipswitch.com/forum/index.php">here</a>.
     <h2 class="sectionheading">
        Dial Plan Applications
     </h2>
     
     <p>The SIP Sorcery dialplans can be written as either Ruby scripts or as line-by-line plans somewhat similar to Asterisk dialplans.
     It is recommended that the Ruby script dialplan is used as the line-by-line plan is no longer under development and does not provide
     access to any dialplan applications except for Dial and Respond.
     </p>
     
     Ruby Dial Plan Applications (incomplete)
     
     <p>
     <span style="color: Blue"><b>Dial(string dialString)</b></span>
      <br />
     Initiates a call to one or more SIP end points and when the first call is answered will bridge it with the SIP user
     agent that initiated the application. The Dial command takes a dial string as a parameter and it controls the order, delay and other types 
     of beahviours for the forwarded call requests. The syntax of the dial string is best demonstrated by an example:
     <br /><br />
     <span style="font-family: Courier">sys.Dial("123@provider1&456@provider2[dt=5]|789@provider3")</span>
     <br /><br />
     The call sequence of this command will be:
     
     <ul>
        <li>A call will be placed to 123@provider1,</li>
        <li>After a 5 second delay a call will be placed to 456@provider2,</li>
        <li>If both calls fail a call will be placed to 789@provider3.</li>
     </ul>

     If at any point one of the forwards answered all other forwards are cancelled and the dialplan execution terminates. The additional options
     that can be used on each call leg are:
     <br /><br />
     <span style="font-family: Courier">sys.Dial("123@provider1[rm=a,cd=3600]&456@provider2[dt=5,rm=a,cd=600]")</span>
     <br />
     <ul>
        <li><b>dt</b>: Delay call start in seconds,</li> 
        <li><b>cd</b>: Answered call duration in seconds,</li>
        <li><b>rm</b>: Redirect mode, a=Add to current call.</li> 
        <li><b>ma</b>: Whether to mangle the SDP, true or false (default is true so use this to specify no mangling on a call leg).</li> 
        <li><b>fd</b>: Sets a custom From header display name for this call leg,</li> 
        <li><b>fu</b>: Sets a custom From header URI username for this call leg,</li>
        <li><b>fh</b>: Sets a custom From header URI host for this call leg,</li>  
     </ul>
     </p>
     
     <p>
     <span style="color: Blue"><b>DBWrite(string key, string value)</b></span>
     <br/>
     Writes a keyed value to the database.
     </p> 
     
      <p>      
     <span style="color: Blue"><b>DBRead(string key)</b></span>
     <br />
      Reads a keyed value from database.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>DBDelete(string key)</b></span>
     <br />
      Deletes a keyed value from database.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>WebGet(string url)</b></span>
     <br />
      Sends a HTTP GET request and returns the result to the dialplan.
     </p> 
     
      <p>      
     <span style="color: Blue"><b>GetCurrentCallCount()</b></span>
     <br />
      Returns the number of calls currently in progress for the calling user.
     </p> 
     
      <p>      
     <span style="color: Blue"><b>DoesSIPAccountExist(string username)</b></span>
     <br />
      Returns true if the specified SIP Account exists on the system, false otherwise.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>SetCustomSIPHeader(string header, string value)</b></span>
     <br />
      Sets a custom SIP header that will be added to all subsequent calls.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>RemoveCustomSIPHeader(string header)</b></span>
     <br />
      Removes the custom SIP header from the list.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>ClearCustomSIPHeaders()</b></span>
     <br />
      Clears all custom SIP headers from the list.
     </p>
     
     <p>      
     <span style="color: Blue"><b>PrintCustomSIPHeaders()</b></span>
     <br />
      Prints custom SIP headers to the monitoring console.
     </p>
     
     <p>      
     <span style="color: Blue"><b>SetFromHeader(string fromName, string fromUser, string fromHost)</b></span>
     <br />
      Sets the From SIP header that will be added to all subsequent calls.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>ClearFromHeader()</b></span>
     <br />
     Resets the From SIP header.
     </p>
     
     <p>      
     <span style="color: Blue"><b>SetCustomContent(string contentType, string content)</b></span>
     <br />
      Sets the Content-Type SIP header and the body that will be used for all subsequent call requests.
     </p> 
     
     <p>      
     <span style="color: Blue"><b>ClearCustomBody()</b></span>
     <br />
     Resets the custom Content-Type SIP header and the body.
     </p>
     
     <p>      
     <span style="color: Blue"><b>Email(string to, string subject, string body)</b></span>
     <br />
     Sends an email. This application requires authorisation which an be gained by sending a 
     request to admin@sipsorcery.com.
     </p>
     
     <p>      
     <span style="color: Blue"><b>GoogleVoiceCall(string emailAddress, string password, string forwardingNumber, string destinationNumber, string fromUserToMatch)</b></span>
     <br />
     Places an outbound call via the Google Voice service. The application works by initiating a callback with the a HTTP request with Google Voice.
     The incoming call leg of the callback is then matched to the call leg that initiated the sipsorcery dial plan execution. 
     <br /><br />
     - The <b>emailAddress</b> and <b>password</b> are the credentials used to login to the Google Voice portal. <br />
     - The <b>forwardingNumber</b> is the number to request the Google Voice callback on. Whatever this number is it needs to get the call to sipsorcery.<br />
     - The <b>destinationNumber</b> is the number that will be passed to the callback as the outgoing leg and is the external number that will be called.<br />
     - The <b>fromUserToMatch</b> is used to match the incoming callback to the SIP call that initiated the dial plan execution. By specifying this field
       sipsorcery will look at the From URI user, in a SIP From header of From: "Joe Bloggs" &lt;sip:12345678@somehost.com&gt; the From URI user is 12345678,
       to match the calls. The fromUserToMatch can be left blank in which case the match will assume Gizmo is the incoming call provider and will perform
       the macth by looking for an X-GoogleVoice: true header and a SIP To URI user equal to the forwardingNumber.
     </p>
     
 </body>
</HTML>